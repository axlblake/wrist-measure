<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mediapipe Hand Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js" crossorigin="anonymous"></script>
  <style>
    body { display:flex; justify-content:center; }
    video, canvas { position:absolute; top:0; left:0; }
    .container { position:relative; width:640px; height:480px; }
  </style>
</head>
<body>
  <div class="container">
    <video id="video" autoplay muted playsinline></video>
    <canvas id="output"></canvas>
  </div>
  <script>
    const video=document.getElementById("video");
    const canvas=document.getElementById("output");
    const ctx=canvas.getContext("2d");
    let handLandmarker, drawingUtils;

    async function init(){
      const vision = await FilesetResolver.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/wasm");
      handLandmarker = await HandLandmarker.createFromOptions(vision, {
        baseOptions: { modelAssetPath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/hand_landmarker.task" },
        runningMode:"VIDEO", numHands:1
      });
      drawingUtils=new DrawingUtils(ctx);
      startCamera();
    }

    async function startCamera(){
      const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
      video.srcObject=stream;
      video.onloadedmetadata=()=>{
        canvas.width=video.videoWidth;
        canvas.height=video.videoHeight;
        video.play();
        requestAnimationFrame(loop);
      };
    }

    async function loop(){
      if(video.readyState===4 && handLandmarker){
        const now=performance.now();
        const result=await handLandmarker.detectForVideo(video, now);
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        if(result.landmarks){
          for(const lm of result.landmarks){
            drawingUtils.drawLandmarks(lm,{color:"red",radius:3});
            drawingUtils.drawConnectors(lm, HandLandmarker.HAND_CONNECTIONS,{color:"lime",lineWidth:2});
          }
        }
      }
      requestAnimationFrame(loop);
    }

    init();
  </script>
</body>
</html>
